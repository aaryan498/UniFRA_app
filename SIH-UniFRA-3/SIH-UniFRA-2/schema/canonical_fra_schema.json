{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Canonical FRA Schema",
  "description": "Unified schema for Frequency Response Analysis data from multiple vendors",
  "type": "object",
  "required": ["asset_metadata", "test_info", "measurement", "raw_file"],
  "properties": {
    "asset_metadata": {
      "type": "object",
      "required": ["asset_id", "manufacturer", "model", "rating_MVA"],
      "properties": {
        "asset_id": {"type": "string", "description": "Unique transformer identifier"},
        "manufacturer": {"type": "string", "description": "Transformer manufacturer"},
        "model": {"type": "string", "description": "Transformer model number"},
        "rating_MVA": {"type": "number", "description": "Power rating in MVA"},
        "winding_config": {"type": "string", "description": "Winding configuration (e.g., Dyn11, YNyn0)"},
        "serial": {"type": "string", "description": "Serial number"},
        "year_installed": {"type": "integer", "description": "Installation year"},
        "voltage_levels": {
          "type": "array",
          "items": {"type": "number"},
          "description": "Voltage levels in kV"
        }
      }
    },
    "test_info": {
      "type": "object",
      "required": ["test_id", "date", "instrument", "test_voltage"],
      "properties": {
        "test_id": {"type": "string", "description": "Unique test identifier"},
        "date": {"type": "string", "format": "date-time", "description": "Test execution date/time"},
        "technician": {"type": "string", "description": "Technician name"},
        "instrument": {"type": "string", "description": "FRA instrument model"},
        "test_voltage": {"type": "number", "description": "Test voltage in V"},
        "coupling": {"type": "string", "description": "Coupling method (capacitive/inductive)"},
        "ambient_temp": {"type": "number", "description": "Ambient temperature in Â°C"},
        "test_conditions": {"type": "string", "description": "Additional test conditions"},
        "calibration_date": {"type": "string", "format": "date", "description": "Instrument calibration date"}
      }
    },
    "measurement": {
      "type": "object",
      "required": ["frequencies", "magnitudes", "unit", "phase"],
      "properties": {
        "frequencies": {
          "type": "array",
          "items": {"type": "number"},
          "description": "Frequency points in Hz",
          "minItems": 10
        },
        "magnitudes": {
          "type": "array",
          "items": {"type": "number"},
          "description": "Magnitude values",
          "minItems": 10
        },
        "phases": {
          "type": "array",
          "items": {"type": "number"},
          "description": "Phase values in degrees (optional)"
        },
        "unit": {
          "type": "string",
          "enum": ["dB", "magnitude", "linear"],
          "description": "Magnitude unit"
        },
        "phase_unit": {
          "type": "string",
          "enum": ["degrees", "radians"],
          "default": "degrees"
        },
        "connection": {
          "type": "string",
          "description": "Measurement connection (e.g., H1-H2, H1-X1)"
        },
        "resolution": {"type": "integer", "description": "Number of frequency points"},
        "freq_start": {"type": "number", "description": "Start frequency in Hz"},
        "freq_end": {"type": "number", "description": "End frequency in Hz"},
        "impedance_ref": {"type": "number", "description": "Reference impedance in Ohms", "default": 50}
      }
    },
    "raw_file": {
      "type": "object",
      "required": ["filename", "vendor_name", "original_format"],
      "properties": {
        "filename": {"type": "string", "description": "Original filename"},
        "vendor_name": {
          "type": "string",
          "enum": ["omicron", "megger", "doble", "newtons4th", "generic"],
          "description": "Vendor/manufacturer name"
        },
        "original_format": {
          "type": "string",
          "enum": ["csv", "xml", "json", "binary", "proprietary"],
          "description": "Original file format"
        },
        "file_size": {"type": "integer", "description": "File size in bytes"},
        "checksum": {"type": "string", "description": "File checksum for integrity"},
        "parser_version": {"type": "string", "description": "Parser version used"}
      }
    },
    "fault_analysis": {
      "type": "object",
      "description": "AI/ML analysis results (populated after processing)",
      "properties": {
        "fault_probabilities": {
          "type": "object",
          "description": "Probability scores for each fault type",
          "properties": {
            "axial_displacement": {"type": "number", "minimum": 0, "maximum": 1},
            "radial_deformation": {"type": "number", "minimum": 0, "maximum": 1},
            "core_grounding": {"type": "number", "minimum": 0, "maximum": 1},
            "turn_turn_short": {"type": "number", "minimum": 0, "maximum": 1},
            "open_circuit": {"type": "number", "minimum": 0, "maximum": 1},
            "insulation_degradation": {"type": "number", "minimum": 0, "maximum": 1},
            "partial_discharge": {"type": "number", "minimum": 0, "maximum": 1},
            "lamination_deform": {"type": "number", "minimum": 0, "maximum": 1},
            "saturation_effect": {"type": "number", "minimum": 0, "maximum": 1},
            "healthy": {"type": "number", "minimum": 0, "maximum": 1}
          }
        },
        "severity_level": {
          "type": "string",
          "enum": ["mild", "moderate", "severe"],
          "description": "Overall fault severity"
        },
        "anomaly_score": {"type": "number", "description": "Anomaly detection score"},
        "confidence": {"type": "number", "minimum": 0, "maximum": 1, "description": "Model confidence"},
        "frequency_bands_affected": {
          "type": "array",
          "items": {
            "type": "object",
            "properties": {
              "band_name": {"type": "string"},
              "freq_start": {"type": "number"},
              "freq_end": {"type": "number"},
              "impact_score": {"type": "number"}
            }
          }
        },
        "recommended_actions": {
          "type": "array",
          "items": {"type": "string"},
          "description": "Expert system recommendations"
        }
      }
    },
    "processing_metadata": {
      "type": "object",
      "description": "Processing pipeline metadata",
      "properties": {
        "processed_date": {"type": "string", "format": "date-time"},
        "model_version": {"type": "string"},
        "preprocessing_steps": {"type": "array", "items": {"type": "string"}},
        "quality_score": {"type": "number", "minimum": 0, "maximum": 1}
      }
    }
  }
}